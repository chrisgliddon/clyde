;------------------
;
;GG_GOL.658
;
;  GOLIATH CONTROL ROUTINES
;
;
;------------------
;EQUATES





;------------------
;INIT_GOLIATH -- START GOLIATH UP
;SET:
;	X,Y
;	CONTROL ROUTINE
;	HIT TABLE CLEARED
;	ANIM #

INIT_GOLIATH	MODULE


	PHP
	SET_AXY16
;-----
;SET THE STARTING X,Y
	LDA	MAP1_X	;USE CURRENT MAP POSITION
	CLC
	ADC	#$70
	STA	OBJ_X	;X
	LDA	MAP1_Y
	CLC
	ADC	#$50
	STA	OBJ_Y	;Y
;
	LDA	#0
	STA	OBJ_SPRITE	;STARING SPRITE #

;-----
	JMP	JMP_GOL_FALL	;SET GOLIATH TO START FALLING

	MODEND

;------------------
;INIT_GOL_FLY -- START GOLIATH UP
;SET:
;	X,Y
;	CONTROL ROUTINE
;	HIT TABLE CLEARED
;	ANIM #

INIT_GOL_FLY	MODULE


	PHP
	SET_AXY16
;-----
;SET THE STARTING X,Y
	LDA	MAP1_X	;USE CURRENT MAP POSITION
	CLC
	ADC	#$70
	STA	OBJ_X	;X
	LDA	MAP1_Y
	CLC
	ADC	#$50
	STA	OBJ_Y	;Y
;-----
	JMP	JMP_GOL_FLY	;SET GOLIATH TO START FALLING

	MODEND

;------------------
;ANIM LIST -- HERE ARE THE ADDRESS OF ALL THE ANIMATION USED IN THE GAME.
;THIS LIST CAN BE COPIED TO RAM IF ANY OF THE ANIM ARE TO BE STORED THERE.


GOL_WALK	DL	GOL_RUN_ANM	;GOLIATH RUN ANIM
GOL_CLIMB	DL	GOL_RUN_ANM	;GOLIATH CLIMBING ANIM
GOL_FALL	DL	GOL_FALL_ANM	;GOLIATH FALLING ANIM
GOL_JUMP	DL	GOL_JMP_ANM	;GOLIATH JUMP ANIMATION
;GOL_IDLE	DL	GOL_IDLE_ANM	;GOLIATH IDLE ANIMATION


;------------------
;SET_GOL_FALL -- SET THE GOLIATH FALLING ANIMATION

SET_GOL_FALL	MODULE

	PHP
	SET_AXY16
;-----
;ENTER HERE IF JUMPING IN

JMP_GOL_FALL

;-----
;SET THE CONTROL ROUTINE
	LDA	#<GOL_CTRL_FALL	;CONTROL ROUTINE
	STA	OBJ_CONTROL
	LDA	#^GOL_CTRL_FALL
	STA	OBJ_CONTROL+2
;-----
;SET THE ADDRESS OF THE HIT TABLE
	STZ	OBJ_HIT  	;CLEAR HIT TABLE ADDRESS
	STZ	OBJ_HIT+2
;-----
;SET THE ADDRESS OF THE ANIM TO PLAY
	LDA	GOL_FALL	;ADDRESS OF WALK ANIM
	STA	OBJ_ANIM
	LDA	GOL_FALL+2
	STA	OBJ_ANIM+2
;-----
;SET THE OBJ_FLAG
	STZ	OBJ_FLAG	;CLEAR IT FOR NOW
	STZ	OBJ_CON	;NO CONTOUR NOW
;-----
;SET THE POINTERS USED BY OTHER ROUTINES
	STZ	OBJ_DWORD	;DOUBLE WORD PTR
	STZ	OBJ_WORD	;WORD PTR
;-----
;GET DATA FROM THE ANIMATION HEADER
	SET_A8
	LDY	#0
;
	LDA	[OBJ_ANIM],Y	;GET SPRITE SIZE
	STA	OBJ_SPR_SIZE
	INY
;
	LDA	[OBJ_ANIM],Y	;GET MAX SPRITES
	STA	OBJ_MAX_SPR
	INY
;
	LDA	[OBJ_ANIM],Y	;GET WIDTH
	STA	OBJ_WIDTH
	INY
;
	LDA	[OBJ_ANIM],Y	;GET HEIGTH
	STA	OBJ_HEIGTH
	INY
	INY		;SKIP COMMAND ?????
;-----
;NOW SET THE ANIMATIONS ADDRESS PAST THE HEADER
	SET_A16
	LDA	OBJ_ANIM
	CLC
	ADC	#4	;SKIP DATA AT HEAD OF ANIM
	STA	OBJ_ANIM
	STA	THIS_OBJ_ANIM
	LDA	OBJ_ANIM+2
	ADC	#0
	STA	OBJ_ANIM+2
	STA	THIS_OBJ_ANIM+2	;SET THE ADDRESS OF THE ANIM LIST
;-----
	LDA	#2
	STA	XSCROLL_RATE
	LDA	#4
	STA	YSCROLL_RATE	;SET FALL SCROLL RATE
;-----
;EXECUTE THE FIRST COMMAND TO DRAW GOLIATH UP ON SCREEN
	JSL	DO_ANIM_CMDS	;EXECUTE THE ANIM LIST NOW
;-----
	PLP
	RTL

	MODEND

;------------------
;SET_GOL_JUMP -- MAKE GOLIATH JUMP

SET_GOL_JUMP	MODULE

	PHP
	SET_AXY16
;-----
;ENTER HERE IF JUMPING IN

JMP_GOL_JUMP
	LDX	#0	;OBJECT #
	JSL	CLR_OBJ_SPRITES	;REMOVE ALL SUB SPRITES FROM SCREEN
;-----
;SET THE CONTROL ROUTINE
	LDA	#<GOL_CTRL_JUMP	;CONTROL ROUTINE
	STA	OBJ_CONTROL
	LDA	#^GOL_CTRL_JUMP
	STA	OBJ_CONTROL+2
;-----
;SET THE ADDRESS OF THE HIT TABLE
	STZ	OBJ_HIT  	;CLEAR HIT TABLE ADDRESS
	STZ	OBJ_HIT+2
;-----
;SET THE ADDRESS OF THE ANIM TO PLAY
	LDA	GOL_JUMP	;ADDRESS OF WALK ANIM
	STA	OBJ_ANIM
	LDA	GOL_JUMP+2
	STA	OBJ_ANIM+2
;-----
;SET THE OBJ_FLAG
	STZ	OBJ_FLAG	;CLEAR IT FOR NOW
;-----
;SET THE POINTERS USED BY OTHER ROUTINES
	STZ	OBJ_DWORD	;DOUBLE WORD PTR
	STZ	OBJ_WORD	;WORD PTR
;-----
;GET DATA FROM THE ANIMATION HEADER
	SET_A8
	LDY	#0
;
	LDA	[OBJ_ANIM],Y	;GET SPRITE SIZE
	STA	OBJ_SPR_SIZE
	INY
;
	LDA	[OBJ_ANIM],Y	;GET MAX SPRITES
	STA	OBJ_MAX_SPR
	INY
;
	LDA	[OBJ_ANIM],Y	;GET WIDTH
	STA	OBJ_WIDTH
	INY
;
	LDA	[OBJ_ANIM],Y	;GET HEIGTH
	STA	OBJ_HEIGTH
	INY
	INY		;SKIP COMMAND ?????
;-----
;NOW SET THE ANIMATIONS ADDRESS PAST THE HEADER
	SET_A16
	LDA	OBJ_ANIM
	CLC
	ADC	#4	;SKIP DATA AT HEAD OF ANIM
	STA	OBJ_ANIM
	STA	THIS_OBJ_ANIM
	LDA	OBJ_ANIM+2
	ADC	#0
	STA	OBJ_ANIM+2
	STA	THIS_OBJ_ANIM+2	;SET THE ADDRESS OF THE ANIM LIST
;-----
	LDA	#2
	STA	XSCROLL_RATE	;SET NEW SCROLL RATE
	LDA	#2
	STA	YSCROLL_RATE
;-----
;EXECUTE THE FIRST COMMAND TO DRAW GOLIATH UP ON SCREEN
	JSL	DO_ANIM_CMDS	;EXECUTE THE ANIM LIST NOW
;-----
	PLP
	RTL

	MODEND

;------------------
;SET_GOL_WALK -- SET GOLIATH'S WALKING ANIMATION

SET_GOL_WALK	MODULE

	PHP
	SET_AXY16
;-----
;ENTER HERE IF JUMPING IN

JMP_GOL_WALK

;-----
;GET THE CONTOUR VALUE HERE
	JSL	FALL_CONTOUR
	STA	OBJ_CON
;-----
;SET THE CONTROL ROUTINE
	LDA	#<GOL_CTRL_WALK	;CONTROL ROUTINE
	STA	OBJ_CONTROL
	LDA	#^GOL_CTRL_WALK
	STA	OBJ_CONTROL+2
;-----
;SET THE ADDRESS OF THE HIT TABLE
	STZ	OBJ_HIT  	;CLEAR HIT TABLE ADDRESS
	STZ	OBJ_HIT+2
;-----
;SET THE ADDRESS OF THE ANIM TO PLAY
	LDA	GOL_WALK	;ADDRESS OF WALK ANIM
	STA	OBJ_ANIM
	LDA	GOL_WALK+2
	STA	OBJ_ANIM+2
;-----
;SET THE OBJ_FLAG
	STZ	OBJ_FLAG	;CLEAR IT FOR NOW
;-----
;SET THE POINTERS USED BY OTHER ROUTINES
	STZ	OBJ_DWORD	;DOUBLE WORD PTR
	STZ	OBJ_WORD	;WORD PTR
;-----
;GET DATA FROM THE ANIMATION HEADER
	SET_A8
	LDY	#0
;
	LDA	[OBJ_ANIM],Y	;GET SPRITE SIZE
	STA	OBJ_SPR_SIZE
	INY
;
	LDA	[OBJ_ANIM],Y	;GET MAX SPRITES
	STA	OBJ_MAX_SPR
	INY
;
	LDA	[OBJ_ANIM],Y	;GET WIDTH
	STA	OBJ_WIDTH
	INY
;
	LDA	[OBJ_ANIM],Y	;GET HEIGTH
	STA	OBJ_HEIGTH
	INY
	INY		;SKIP COMMAND ?????
;-----
;NOW SET THE ANIMATIONS ADDRESS PAST THE HEADER
	SET_A16
	LDA	OBJ_ANIM
	CLC
	ADC	#4	;SKIP DATA AT HEAD OF ANIM
	STA	OBJ_ANIM
	STA	THIS_OBJ_ANIM
	LDA	OBJ_ANIM+2
	ADC	#0
	STA	OBJ_ANIM+2
	STA	THIS_OBJ_ANIM+2	;SET THE ADDRESS OF THE ANIM LIST
;-----
	LDA	#2
	STA	XSCROLL_RATE	;SET NEW SCROLL RATE
	STA	YSCROLL_RATE
;-----
;EXECUTE THE FIRST COMMAND TO DRAW GOLIATH UP ON SCREEN
	JSL	DO_ANIM_CMDS	;EXECUTE THE ANIM LIST NOW
;-----
	PLP
	RTL

	MODEND

;------------------
;SET_GOL_IDLE -- SET GOLIATH'S IDLE ANIMATION

SET_GOL_IDLE	MODULE

	PHP
	SET_AXY16
;-----
;ENTER HERE IF JUMPING IN

JMP_GOL_IDLE

;-----
;GET THE CONTOUR VALUE HERE
	JSL	FALL_CONTOUR
	STA	OBJ_CON
;-----
;SET THE CONTROL ROUTINE
	LDA	#<GOL_CTRL_IDLE	;CONTROL ROUTINE
	STA	OBJ_CONTROL
	LDA	#^GOL_CTRL_IDLE
	STA	OBJ_CONTROL+2
;-----
;SET THE ADDRESS OF THE HIT TABLE
	STZ	OBJ_HIT  	;CLEAR HIT TABLE ADDRESS
	STZ	OBJ_HIT+2
;-----
;SET THE ADDRESS OF THE ANIM TO PLAY
	LDA	GOL_IDLE	;ADDRESS OF WALK ANIM
	STA	OBJ_ANIM
	LDA	GOL_IDLE+2
	STA	OBJ_ANIM+2
;-----
;SET THE OBJ_FLAG
	STZ	OBJ_FLAG	;CLEAR IT FOR NOW
;-----
;SET THE POINTERS USED BY OTHER ROUTINES
	STZ	OBJ_DWORD	;DOUBLE WORD PTR
	STZ	OBJ_WORD	;WORD PTR
;-----
;GET DATA FROM THE ANIMATION HEADER
	SET_A8
	LDY	#0
;
	LDA	[OBJ_ANIM],Y	;GET SPRITE SIZE
	STA	OBJ_SPR_SIZE
	INY
;
	LDA	[OBJ_ANIM],Y	;GET MAX SPRITES
	STA	OBJ_MAX_SPR
	INY
;
	LDA	[OBJ_ANIM],Y	;GET WIDTH
	STA	OBJ_WIDTH
	INY
;
	LDA	[OBJ_ANIM],Y	;GET HEIGTH
	STA	OBJ_HEIGTH
	INY
	INY		;SKIP COMMAND ?????
;-----
;NOW SET THE ANIMATIONS ADDRESS PAST THE HEADER
	SET_A16
	LDA	OBJ_ANIM
	CLC
	ADC	#4	;SKIP DATA AT HEAD OF ANIM
	STA	OBJ_ANIM
	STA	THIS_OBJ_ANIM
	LDA	OBJ_ANIM+2
	ADC	#0
	STA	OBJ_ANIM+2
	STA	THIS_OBJ_ANIM+2	;SET THE ADDRESS OF THE ANIM LIST
;-----
	LDA	#2
	STA	XSCROLL_RATE	;SET NEW SCROLL RATE
	STA	YSCROLL_RATE
;-----
;EXECUTE THE FIRST COMMAND TO DRAW GOLIATH UP ON SCREEN
	JSL	DO_ANIM_CMDS	;EXECUTE THE ANIM LIST NOW
;-----
	PLP
	RTL

	MODEND

;------------------
;SET_GOL_FLY -- SET GOLIATH'S FLYING ANIMATION

SET_GOL_FLY	MODULE

	PHP
	SET_AXY16
;-----
;ENTER HERE IF JUMPING IN

JMP_GOL_FLY

;-----
;GET THE CONTOUR VALUE HERE
	JSL	FALL_CONTOUR
	STA	OBJ_CON
;-----
;SET THE CONTROL ROUTINE
	LDA	#<GOL_CTRL_FLY	;CONTROL ROUTINE
	STA	OBJ_CONTROL
	LDA	#^GOL_CTRL_FLY
	STA	OBJ_CONTROL+2
;-----
;SET THE ADDRESS OF THE HIT TABLE
	STZ	OBJ_HIT  	;CLEAR HIT TABLE ADDRESS
	STZ	OBJ_HIT+2
;-----
;SET THE ADDRESS OF THE ANIM TO PLAY
	LDA	GOL_WALK	;ADDRESS OF WALK ANIM
	STA	OBJ_ANIM
	LDA	GOL_WALK+2
	STA	OBJ_ANIM+2
;-----
;SET THE OBJ_FLAG
	STZ	OBJ_FLAG	;CLEAR IT FOR NOW
;-----
;SET THE POINTERS USED BY OTHER ROUTINES
	STZ	OBJ_DWORD	;DOUBLE WORD PTR
	STZ	OBJ_WORD	;WORD PTR
;-----
;GET DATA FROM THE ANIMATION HEADER
	SET_A8
	LDY	#0
;
	LDA	[OBJ_ANIM],Y	;GET SPRITE SIZE
	STA	OBJ_SPR_SIZE
	INY
;
	LDA	[OBJ_ANIM],Y	;GET MAX SPRITES
	STA	OBJ_MAX_SPR
	INY
;
	LDA	[OBJ_ANIM],Y	;GET WIDTH
	STA	OBJ_WIDTH
	INY
;
	LDA	[OBJ_ANIM],Y	;GET HEIGTH
	STA	OBJ_HEIGTH
	INY
	INY		;SKIP COMMAND ?????
;-----
;NOW SET THE ANIMATIONS ADDRESS PAST THE HEADER
	SET_A16
	LDA	OBJ_ANIM
	CLC
	ADC	#4	;SKIP DATA AT HEAD OF ANIM
	STA	OBJ_ANIM
	STA	THIS_OBJ_ANIM
	LDA	OBJ_ANIM+2
	ADC	#0
	STA	OBJ_ANIM+2
	STA	THIS_OBJ_ANIM+2	;SET THE ADDRESS OF THE ANIM LIST
;-----
	LDA	#2
	STA	XSCROLL_RATE	;SET NEW SCROLL RATE
	STA	YSCROLL_RATE
;-----
;EXECUTE THE FIRST COMMAND TO DRAW GOLIATH UP ON SCREEN
	JSL	DO_ANIM_CMDS	;EXECUTE THE ANIM LIST NOW
;-----
	PLP
	RTL

	MODEND

;------------------
IDLE_OR_WALK -- SEE IF GOLIATH SHOULD IDLE OR WALK

IDLE_OR_WALK	MODULE

;	SET_A16
;	LDA	JOY1_DATA
;	BIT	#JOY_RIGHT
;	BNE	SHOULD_WALK
;	BIT	#JOY_LEFT
;	BNE	SHOULD_WALK
;	JMP	JMP_GOL_IDLE	;DO IDLE, NO INPUT
;SHOULD_WALK	JMP	JMP_GOL_WALK
;
	MODEND

;------------------
;------------------
;------------------
;------------------

;------------------
;GOL_CTRL_IDLE -- GOLIATH IDLE

GOL_CTRL_IDLE	MODULE

	PHP
	SET_AXY16
;-----
	LDA	NMI_CTR	;GET CURRENT TIME
	CLC
	ADC	#4
	STA	OBJ_TIME	;BE SURE TO RETURN IF NO MOVEMENT
;-----
;WHAT DIR TO WALK ?
	LDA	JOY1_DATA	;GET JOYSTICK DATA
	BIT	#JOY_RIGHT	;MOVE RIGHT ?
	BNE	@WALK_RIGHT
	JMP	@NOT_RIGHT
;-----
@WALK_RIGHT	SET_A8
	LDA	#0
	STA	OBJ_FLIP	;NO FLIP
	SET_A16
	JMP	JMP_GOL_WALK
;-----
@NOT_RIGHT	BIT	#JOY_LEFT	;MOVE LEFT ?
	BEQ	@IDLE_DONE
	SET_A8
	LDA	#$40	;HORZ FLIP
	STA	OBJ_FLIP
	SET_A16
	JMP	JMP_GOL_WALK
;-----
@IDLE_DONE	PLP
	RTL

        	MODEND

;------------------
;GOL_CTRL_WALK -- GOLIATH WALKING

GOL_CTRL_WALK	MODULE

	PHP
	SET_AXY16
;-----
	LDA	NMI_CTR	;GET CURRENT TIME
	CLC
	ADC	#4
	STA	OBJ_TIME	;BE SURE TO RETURN IF NO MOVEMENT
;-----
;SEE IF GOLIATH SHOULD JUMP
	LDA	JOY1_DATA
	BIT	#JOY_BBUTT	;JUMP BUTTON PRESSED ?
	BEQ	NO_JUMP
	JMP	JMP_GOL_JUMP	;MAKE GOLIATH JUMP
;-----
;WHAT DIR TO WALK ?
NO_JUMP	LDA	JOY1_DATA	;GET JOYSTICK DATA
	BIT	#JOY_RIGHT	;MOVE RIGHT ?
	BNE	@WALK_RIGHT
	JMP	@NOT_RIGHT
;-----
@WALK_RIGHT	SET_A8
	LDA	#0
	STA	OBJ_FLIP	;NO FLIP
	SET_A16
;-----
;SEE IF IT HIT ANYTHING
	JSL	CK_SPECIAL_RIGHT	;ANYTHING TO THE RIGHT
	CMP	#0
	BNE	@WALK_DONE
;-----
@WALK_CONT	LDA	OBJ_ANIM
	STA	THIS_OBJ_ANIM
	LDA	OBJ_ANIM+2
	STA	THIS_OBJ_ANIM+2
;-----
	LDA	JOY1_DATA	;GET JOYSTICK INPUT
	BIT	#JOY_UP	;GO UP ?
	BNE	@CK_UP
	BIT	#JOY_DOWN
	BEQ	@CK_NORMAL
	JSL	WALK_DOWN_CON
	JMP	@CK_DONE
;
@CK_UP	JSL	WALK_UP_CON
	JMP	@CK_DONE
;
@CK_NORMAL	JSL	WALK_CONTOUR
;
@CK_DONE	CMP	#0
	BEQ	@GO_FALL
	PHA
	SEC
	SBC	OBJ_CON	;SUB LAST CONTOUR
	CLC
	ADC	OBJ_Y
	STA	OBJ_Y
	PLA
	BIT	#$8000	;NEG CONTOUR ?
	BEQ	@CON_OK
	CLC
	ADC	#16	;MAKE POS VALUE
	JMP	@CON_OK2
@CON_OK	CMP	#16+1
	BLT	@CON_OK2
	SEC
	SBC	#16
@CON_OK2	STA	OBJ_CON
;-----
	JSL	DO_ANIM_CMDS	;EXECUTE THE ANIM LIST NOW
;-----
	LDA	OBJ_CON	;LOOK AT CONTOUR UNDER FEET
	CMP	#0	;IS IT = 0 ?
	BNE	@WALK_DONE
@GO_FALL	JSL	SET_GOL_FALL	;THEN GOLIATH MUST FALL
;-----
@WALK_DONE	PLP
	RTL
;
@NOT_RIGHT	BIT	#JOY_LEFT	;MOVE LEFT ?
	BEQ	@WALK_DONE
	SET_A8
	LDA	#$40	;HORZ FLIP
	STA	OBJ_FLIP
	SET_A16
;-----
;SEE IF IT HIT ANYTHING
	JSL	CK_SPECIAL_LEFT	;ANYTHING TO THE LEFT
	CMP	#0
	BNE	@WALK_DONE
	JMP	@WALK_CONT

        	MODEND

;------------------
;GOL_CTRL_FLY -- GOLIATH FLYING

GOL_CTRL_FLY	MODULE

	PHP
	SET_AXY16
;-----
	LDA	NMI_CTR	;GET CURRENT TIME
	CLC
	ADC	#4
	STA	OBJ_TIME	;BE SURE TO RETURN IF NO MOVEMENT
;-----
;WHAT DIR TO FLY ?
	LDA	JOY1_DATA	;GET JOYSTICK DATA
	BIT	#JOY_RIGHT	;MOVE RIGHT ?
	BNE	@FLY_LEFT
	JMP	@NOT_RIGHT
;-----
@FLY_LEFT	SET_A8
	LDA	#0
	STA	OBJ_FLIP	;NO FLIP
	SET_A16
;-----
@FLY_CONT	LDA	OBJ_ANIM
	STA	THIS_OBJ_ANIM
	LDA	OBJ_ANIM+2
	STA	THIS_OBJ_ANIM+2
;-----
	JSL	DO_ANIM_CMDS	;EXECUTE THE ANIM LIST NOW
;-----
@FLY_DONE	PLP
	RTL
;
@NOT_RIGHT	BIT	#JOY_LEFT	;MOVE LEFT ?
	BEQ	@FLY_UP_DOWN
	SET_A8
	LDA	#$40	;HORZ FLIP
	STA	OBJ_FLIP
	SET_A16
	JMP	@FLY_CONT
;-----
@FLY_UP_DOWN	BIT	#JOY_UP	;FLY UP
	BEQ	@FLY_DOWN
	LDA	OBJ_Y
	SEC
	SBC	#6
	STA	OBJ_Y
	JMP	@FLY_CONT
;-----
@FLY_DOWN	BIT	#JOY_DOWN	;FLY DOWN
	BEQ	@FLY_DONE
	LDA	OBJ_Y
	CLC
	ADC	#6
	STA	OBJ_Y
	JMP	@FLY_CONT

        	MODEND

;------------------
;GOL_CTRL_FALL -- GOLIATH FALLING NOW

GOL_CTRL_FALL	MODULE

	PHP
	SET_AXY16
;-----
	JSL	FALL_CONTOUR	;GET CONTOUR #
	CMP	#0
	BNE	@IS_BOTTOM	;HIT A CONTOUR
	JMP	@NOT_BOTTOM
;-----
@IS_BOTTOM	DEC	A
	STA	TEMP_X
	LDA	CON_Y	;GET CONTOUR Y
	AND	#$FFF0	;MASK OFF LOWER 16
	ORA	TEMP_X
	SEC
	SBC	#60	;GOL HEIGTH
	STA	OBJ_Y
	JMP	IDLE_OR_WALK	;SET THE WALK ANIM
;-----
;CHANGE DIR WHILE DROPPING
@NOT_BOTTOM	LDA	JOY1_DATA	;GET JOYSTICK DATA
	BIT	#JOY_RIGHT	;MOVE RIGHT ?
	BEQ	@NOT_RIGHT
;
	SET_A8
	LDA	#0
	STA	OBJ_FLIP	;NO FLIP
	SET_A16
	LDA	OBJ_X
	CLC
	ADC	#2
	STA	OBJ_X
	JMP	@JUST_FALL
;
	LONGA ON
@NOT_RIGHT	BIT	#JOY_LEFT	;MOVE LEFT ?
	BEQ	@JUST_FALL
;
	SET_A8
	LDA	#$40	;HORZ FLIP
	STA	OBJ_FLIP
	SET_A16
	LDA	OBJ_X
	SEC
	SBC	#2
	STA	OBJ_X
;
@JUST_FALL	LDA	OBJ_ANIM
	STA	THIS_OBJ_ANIM
	LDA	OBJ_ANIM+2
	STA	THIS_OBJ_ANIM+2

	JSL	DO_ANIM_CMDS	;EXECUTE THE ANIM LIST NOW
;
	PLP
	RTL

        	MODEND

;------------------
;GOL_CTRL_JUMP -- DO GOLIATHS JUMP

GOL_CTRL_JUMP	MODULE

	PHP
	SET_AXY16
;-----
;SEEIF GOLIATH HAS FALLEN ONTO A CONTOUR OBJ_FLAG = 1
;OR IF GOLIATH IS STILL JUMPING OBJ_FLAG = 0
;
	LDA	OBJ_FLAG
	CMP	#1
	BNE	@NOT_LAND	;STILL JUMPING
;-----
	JSL	FALL_CONTOUR	;GET CONTOUR HERE
	STA	OBJ_CON
	CMP	#0
	BNE	@IS_DONE	;LANDED ON A CONTOUR
;-----
;GO AHEAD AND CONTINUE JUMP ANIMATION
;
@NOT_LAND	LDA	JOY1_DATA	;SEE IF WE NEED TO MOVE RIGHT OR LEFT
	BIT	#JOY_RIGHT	;JUMP RIGHT ?
	BEQ	@TRY_LEFT
;-----
	SET_A8
	LDA	#0
	STA	OBJ_FLIP
	SET_A16
;-----
;SEE IF HITTING SOMETHING
	JSL	CK_SPECIAL_RIGHT
	CMP	#0
	BNE	@JMP_CONT
;-----
	LDA	OBJ_X
	CLC
	ADC	#8
	STA	OBJ_X
	JMP	@JMP_CONT
;
@TRY_LEFT	BIT	#JOY_LEFT	;JUMP LEFT ?
	BEQ	@JMP_CONT
;-----
	SET_A8
	LDA	#$40
	STA	OBJ_FLIP
	SET_A16
;-----
;SEE IF HITTING SOMETHING
	JSL	CK_SPECIAL_RIGHT
	CMP	#0
	BNE	@JMP_CONT
;-----
	LDA	OBJ_X
	SEC
	SBC	#8
	STA	OBJ_X
;-----
@JMP_CONT	LDA	OBJ_ANIM
	STA	THIS_OBJ_ANIM
	LDA	OBJ_ANIM+2
	STA	THIS_OBJ_ANIM+2
;-----
	JSL	DO_ANIM_CMDS	;EXECUTE THE ANIM LIST NOW
;-----
;SEE IF GOLIATH HAS LANDED OBJ_FLAG = -1
	LDA	OBJ_FLAG
	CMP	#-1	;END OF ANIM
	BNE	@IS_OK
	JSL	FALL_CONTOUR	;SEE IF CONTOUR UNDER LANDING AREA
	CMP	#0
	BNE	@IS_DONE	;WAS CONTOUR UNDER GOLIATH SO WALK
	JMP	JMP_GOL_FALL	;NO CONTOUR SO FALL
;-----
@IS_OK	PLP
	RTL
;-----
;SET THE WALK ROUTINE
;
@IS_DONE	DEC	A
	STA	TEMP_X
	LDA	CON_Y	;GET CONTOUR Y
	AND	#$FFF0	;MASK OFF LOWER 16
	ORA	TEMP_X
	SEC
	SBC	#60	;GOL HEIGTH
	STA	OBJ_Y
	JMP	IDLE_OR_WALK	;SET THE WALK ANIMATION

	MODEND

;------------------
;WALK_CONTOUR -- RETURN CONTOUR VALUE
;
;1) LOOK IN CURRENT BLOCK
;	IF CONTOUR FOUND THEN RETURN VALUE
;2) IF NOT FOUND LOOK IN BLOCK ABOVE
;	IF CONTOUR FOUND THEN RETURN VALUE = CONTOUR - 16
;3) IF NOT THEN LOOK IN BLOCK BELOW
;	IF CONTOUR FOUND THEN RETURN VALUE = CONTOUR + 16
;4) IF NOT FOUND THEN RETURN ZERO


WALK_CONTOUR	MODULE

	PHP
	SET_AXY16
;-----
	LDA	OBJ_WIDTH	;HALF OF WIDTH
	LSR	A
	CLC
	ADC	OBJ_X	; + X
	STA	CON_X	;= CONTOUR X
	LSR	A
	LSR	A
	LSR	A
	LSR	A	; / 16
	TAY
	LDX	MAP1_WIDTH	;MAP WIDTH
	LDA	OBJ_Y
	CLC
	ADC	#60	;OBJ_HEIGTH
	STA	CON_Y	;
	LSR	A
	LSR	A
	LSR	A
	LSR	A	; / 16
	JSL	CALC_OFF	;CALC THE OFFSET IN MAP
;-----
;LOOK IN CURRENT BLOCK
	LDY	MAP_OFF
	LDA	[MAP1_IN_RAM],Y	;GET MAP DATA
	AND	#$03FF	;JUST INDEX DATA
	ASL	A
	ASL	A
	TAY
	LDA	[FLR_IN_ROM],Y	;GET FLOOR DATA
	STA	TEMP_X
	LDA	CON_X
	AND	#$000F
	CLC
	ADC	TEMP_X
	TAY
	LDA	#0	;CLEAR HIGH WORD
	SET_A8
	LDA	[CON_IN_ROM],Y	;GET CONTOUR DATA
	CMP	#0
	BEQ	@CON_UP
;-----
@CON_OK	PLP
	RTL
;-----
;LOOK IN BLOCK ABOVE
@CON_UP	SET_A16
	LDA	MAP1_WIDTH
	ASL	A
	STA	TEMP_X
	LDA	MAP_OFF
	SEC
	SBC	TEMP_X	;LOOK 1 BLOCK UP
	TAY
;
	LDA	[MAP1_IN_RAM],Y	;GET MAP DATA
	AND	#$03FF	;JUST INDEX DATA
	ASL	A
	ASL	A
	TAY
	LDA	[FLR_IN_ROM],Y	;GET FLOOR DATA
	STA	TEMP_X
	LDA	CON_X
	AND	#$000F
	CLC
	ADC	TEMP_X
	TAY
	LDA	#0	;CLEAR HIGH WORD
	SET_A8
	LDA	[CON_IN_ROM],Y	;GET CONTOUR DATA
	CMP	#0
	BEQ	@CON_DOWN
	SET_A16
	SEC
	SBC	#16	;ADJUST FOR BLOCK ABOVE
	BNE	@CON_OK
	LDA	#-1
	PLP
	RTL
;-----
@CON_DOWN	SET_A16
	LDA	MAP1_WIDTH
	ASL	A
	CLC
	ADC	MAP_OFF	;NEXT ROW DOWN
	TAY
;
	LDA	[MAP1_IN_RAM],Y	;GET MAP DATA
	AND	#$03FF	;JUST INDEX DATA
	ASL	A
	ASL	A
	TAY
	LDA	[FLR_IN_ROM],Y	;GET FLOOR DATA
	STA	TEMP_X
	LDA	CON_X
	AND	#$000F
	CLC
	ADC	TEMP_X
	TAY
	LDA	#0	;CLEAR HIGH WORD
	SET_A8
	LDA	[CON_IN_ROM],Y	;GET CONTOUR DATA
	CMP	#0
	BEQ	@CON_OK
	SET_A16
	CLC
	ADC	#16	;ADJUST FOR BLOCK ABOVE
	PLP
	RTL
	
	MODEND

;------------------
;WALK_UP_CON -- RETURN CONTOUR VALUE

WALK_UP_CON	MODULE

	PHP
	SET_AXY16
;-----
	LDA	OBJ_WIDTH	;HALF OF WIDTH
	LSR	A
	CLC
	ADC	OBJ_X	; + X
	STA	CON_X	;= CONTOUR X
	LSR	A
	LSR	A
	LSR	A
	LSR	A	; / 16
	TAY
	LDX	MAP1_WIDTH	;MAP WIDTH
	LDA	OBJ_Y
	CLC
	ADC	#60	;OBJ_HEIGTH
	STA	CON_Y	;
	LSR	A
	LSR	A
	LSR	A
	LSR	A	; / 16
	JSL	CALC_OFF	;CALC THE OFFSET IN MAP
;-----
;LOOK IN BLOCK ABOVE FIRST
	LDA	MAP1_WIDTH
	ASL	A
	STA	TEMP_X
	LDA	MAP_OFF
	SEC
	SBC	TEMP_X	;LOOK 1 BLOCK UP
	TAY
;
	LDA	[MAP1_IN_RAM],Y	;GET MAP DATA
	AND	#$03FF	;JUST INDEX DATA
	ASL	A
	ASL	A
	TAY
	LDA	[FLR_IN_ROM],Y	;GET FLOOR DATA
	STA	TEMP_X
	LDA	CON_X
	AND	#$000F
	CLC
	ADC	TEMP_X
	TAY
	LDA	#0	;CLEAR HIGH WORD
	SET_A8
	LDA	[CON_IN_ROM],Y	;GET CONTOUR DATA
	CMP	#0
	BEQ	@CON_NORMAL
	SET_A16
	SEC
	SBC	#16	;ADJUST FOR BLOCK ABOVE
	BNE	@CON_OK
	LDA	#-1
	PLP
	RTL
;-----
;LOOK IN CURRENT BLOCK
@CON_NORMAL	SET_A16
	LDY	MAP_OFF
	LDA	[MAP1_IN_RAM],Y	;GET MAP DATA
	AND	#$03FF	;JUST INDEX DATA
	ASL	A
	ASL	A
	TAY
	LDA	[FLR_IN_ROM],Y	;GET FLOOR DATA
	STA	TEMP_X
	LDA	CON_X
	AND	#$000F
	CLC
	ADC	TEMP_X
	TAY
	LDA	#0	;CLEAR HIGH WORD
	SET_A8
	LDA	[CON_IN_ROM],Y	;GET CONTOUR DATA
	CMP	#0
	BEQ	@CON_DOWN
;-----
@CON_OK	PLP
	RTL
;-----
@CON_DOWN	SET_A16
	LDA	MAP1_WIDTH
	ASL	A
	CLC
	ADC	MAP_OFF	;NEXT ROW DOWN
	TAY
;
	LDA	[MAP1_IN_RAM],Y	;GET MAP DATA
	AND	#$03FF	;JUST INDEX DATA
	ASL	A
	ASL	A
	TAY
	LDA	[FLR_IN_ROM],Y	;GET FLOOR DATA
	STA	TEMP_X
	LDA	CON_X
	AND	#$000F
	CLC
	ADC	TEMP_X
	TAY
	LDA	#0	;CLEAR HIGH WORD
	SET_A8
	LDA	[CON_IN_ROM],Y	;GET CONTOUR DATA
	CMP	#0
	BEQ	@CON_OK
	SET_A16
	CLC
	ADC	#16	;ADJUST FOR BLOCK ABOVE
	PLP
	RTL
	
	MODEND

;------------------
;WALK_DOWN_CON -- RETURN CONTOUR VALUE

WALK_DOWN_CON	MODULE

	PHP
	SET_AXY16
;-----
	LDA	OBJ_WIDTH	;HALF OF WIDTH
	LSR	A
	CLC
	ADC	OBJ_X	; + X
	STA	CON_X	;= CONTOUR X
	LSR	A
	LSR	A
	LSR	A
	LSR	A	; / 16
	TAY
	LDX	MAP1_WIDTH	;MAP WIDTH
	LDA	OBJ_Y
	CLC
	ADC	#60	;OBJ_HEIGTH
	STA	CON_Y	;
	LSR	A
	LSR	A
	LSR	A
	LSR	A	; / 16
	JSL	CALC_OFF	;CALC THE OFFSET IN MAP
;-----
;LOOK AT BLOCK BELOW FIRST
	LDA	MAP1_WIDTH
	ASL	A
	CLC
	ADC	MAP_OFF	;NEXT ROW DOWN
	TAY
;
	LDA	[MAP1_IN_RAM],Y	;GET MAP DATA
	AND	#$03FF	;JUST INDEX DATA
	ASL	A
	ASL	A
	TAY
	LDA	[FLR_IN_ROM],Y	;GET FLOOR DATA
	STA	TEMP_X
	LDA	CON_X
	AND	#$000F
	CLC
	ADC	TEMP_X
	TAY
	LDA	#0	;CLEAR HIGH WORD
	SET_A8
	LDA	[CON_IN_ROM],Y	;GET CONTOUR DATA
	CMP	#0
	BEQ	@CON_NORMAL	;LOOK IN MIDDLE
	SET_A16
	CLC
	ADC	#16	;ADJUST FOR BLOCK ABOVE
	PLP
	RTL
;-----
;LOOK IN CURRENT BLOCK
@CON_NORMAL	SET_A16
	LDY	MAP_OFF
	LDA	[MAP1_IN_RAM],Y	;GET MAP DATA
	AND	#$03FF	;JUST INDEX DATA
	ASL	A
	ASL	A
	TAY
	LDA	[FLR_IN_ROM],Y	;GET FLOOR DATA
	STA	TEMP_X
	LDA	CON_X
	AND	#$000F
	CLC
	ADC	TEMP_X
	TAY
	LDA	#0	;CLEAR HIGH WORD
	SET_A8
	LDA	[CON_IN_ROM],Y	;GET CONTOUR DATA
	CMP	#0
	BEQ	@CON_UP
;-----
@CON_OK	PLP
	RTL
;-----
;LOOK IN BLOCK ABOVE LAST
@CON_UP	SET_A16
	LDA	MAP1_WIDTH
	ASL	A
	STA	TEMP_X
	LDA	MAP_OFF
	SEC
	SBC	TEMP_X	;LOOK 1 BLOCK UP
	TAY
;
	LDA	[MAP1_IN_RAM],Y	;GET MAP DATA
	AND	#$03FF	;JUST INDEX DATA
	ASL	A
	ASL	A
	TAY
	LDA	[FLR_IN_ROM],Y	;GET FLOOR DATA
	STA	TEMP_X
	LDA	CON_X
	AND	#$000F
	CLC
	ADC	TEMP_X
	TAY
	LDA	#0	;CLEAR HIGH WORD
	SET_A8
	LDA	[CON_IN_ROM],Y	;GET CONTOUR DATA
	CMP	#0
	BEQ	@CON_OK
	SET_A16
	SEC
	SBC	#16	;ADJUST FOR BLOCK ABOVE
	BNE	@CON_OK
	LDA	#-1
	PLP
	RTL
	
	MODEND

;------------------
;FALL_CONTOUR -- RETURN CONTOUR VALUE
;
;1) LOOK IN CURRENT BLOCK
;	IF CONTOUR FOUND THEN RETURN VALUE
;2) IF NOT FOUND LOOK IN BLOCK ABOVE
;	IF CONTOUR FOUND THEN RETURN VALUE = CONTOUR - 16
;3) IF NOT THEN LOOK IN BLOCK BELOW
;	IF CONTOUR FOUND THEN RETURN VALUE = CONTOUR + 16
;4) IF NOT FOUND THEN RETURN ZERO


FALL_CONTOUR	MODULE

	PHP
	SET_AXY16
;-----
	LDA	OBJ_WIDTH	;HALF OF WIDTH
	LSR	A
	CLC
	ADC	OBJ_X	; + X
	STA	CON_X	;= CONTOUR X
	LSR	A
	LSR	A
	LSR	A
	LSR	A	; / 16
	TAY
	LDX	MAP1_WIDTH	;MAP WIDTH
	LDA	OBJ_Y
	CLC
	ADC	#60	;OBJ_HEIGTH
	STA	CON_Y	;
	LSR	A
	LSR	A
	LSR	A
	LSR	A	; / 16
	JSL	CALC_OFF	;CALC THE OFFSET IN MAP
;-----
;LOOK IN CURRENT BLOCK
	LDY	MAP_OFF
	LDA	[MAP1_IN_RAM],Y	;GET MAP DATA
	AND	#$03FF	;JUST INDEX DATA
	ASL	A
	ASL	A
	TAY
	LDA	[FLR_IN_ROM],Y	;GET FLOOR DATA
	STA	TEMP_X
	LDA	CON_X
	AND	#$000F
	CLC
	ADC	TEMP_X
	TAY
	LDA	#0	;CLEAR HIGH WORD
	SET_A8
	LDA	[CON_IN_ROM],Y	;GET CONTOUR DATA
;-----
	PLP
	RTL

	MODEND

;------------------
;CK_SPECIAL_RIGHT -- RETURN SPECIAL TILE VALUE

CK_SPECIAL_RIGHT	MODULE

	PHP
	SET_AXY16
;-----
	LDA	OBJ_WIDTH	;HALF OF WIDTH
	LSR	A
	CLC
	ADC	OBJ_X	; + X
	STA	CON_X	;= CONTOUR X
	LSR	A
	LSR	A
	LSR	A
	LSR	A	; / 16
	TAY
	LDX	MAP1_WIDTH	;MAP WIDTH
	LDA	OBJ_Y
	CLC
	ADC	#60	;OBJ_HEIGTH
	STA	CON_Y	;
	LSR	A
	LSR	A
	LSR	A
	LSR	A	; / 16
	JSL	CALC_OFF	;CALC THE OFFSET IN MAP
;-----
;LOOK IN BLOCK AHEAD
	LDY	MAP_OFF
	INY		;NEXT BLOCK TO RIGHT
	INY
	LDA	[MAP1_IN_RAM],Y	;GET MAP DATA
	AND	#$03FF	;JUST INDEX DATA
	ASL	A
	ASL	A
	TAY
	INY
	INY
	LDA	#0
	SET_A8
	LDA	[FLR_IN_ROM],Y	;GET SPECIAL DATA
;-----
	PLP
	RTL

	MODEND

;------------------
;CK_SPECIAL_LEFT -- RETURN SPECIAL TILE VALUE

CK_SPECIAL_LEFT	MODULE

	PHP
	SET_AXY16
;-----
	LDA	OBJ_WIDTH	;HALF OF WIDTH
	LSR	A
	CLC
	ADC	OBJ_X	; + X
	STA	CON_X	;= CONTOUR X
	LSR	A
	LSR	A
	LSR	A
	LSR	A	; / 16
	TAY
	LDX	MAP1_WIDTH	;MAP WIDTH
	LDA	OBJ_Y
	CLC
	ADC	#60	;OBJ_HEIGTH
	STA	CON_Y	;
	LSR	A
	LSR	A
	LSR	A
	LSR	A	; / 16
	JSL	CALC_OFF	;CALC THE OFFSET IN MAP
;-----
;LOOK IN BLOCK AHEAD
	LDY	MAP_OFF
	DEY
	DEY
	LDA	[MAP1_IN_RAM],Y	;GET MAP DATA
	AND	#$03FF	;JUST INDEX DATA
	ASL	A
	ASL	A
	TAY
	INY
	INY
	LDA	#0
	SET_A8
	LDA	[FLR_IN_ROM],Y	;GET SPECIAL DATA
;-----
	PLP
	RTL

	MODEND

;------------------
;------------------
;------------------
;------------------
;------------------
;------------------
